<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.foya.dao.mybatis.mapper.UTbInvMaterialMapper" >
  <resultMap id="BaseResultMap" type="com.foya.noms.dto.inv.TbInvMaterialDTO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    <id column="mat_no" 		property="mat_no" jdbcType="VARCHAR" />
    <result column="mat_name" 	property="mat_name" jdbcType="VARCHAR" />
    <result column="catg1_code" property="catg1_code" jdbcType="VARCHAR" />
    <result column="catg1_name" property="catg1_name" jdbcType="VARCHAR" />
    <result column="catg2_code" property="catg2_code" jdbcType="VARCHAR" />
    <result column="catg2_name" property="catg2_name" jdbcType="VARCHAR" />
    <result column="catg3_code" property="catg3_code" jdbcType="VARCHAR" />
    <result column="catg3_name" property="catg3_name" jdbcType="VARCHAR" />
    <result column="unit" 		property="unit" jdbcType="VARCHAR" />
    <result column="ctrl_type" 	property="ctrl_type" jdbcType="CHAR" />
    <result column="ctrl_type_dscr" property="ctrl_type_dscr" jdbcType="VARCHAR" />
    <result column="is_asset" 	property="is_asset" jdbcType="BIT" />
    <result column="is_asset_dscr" property="is_asset_dscr" jdbcType="VARCHAR" />
    <!--<result column="asset_type" property="asset_type" jdbcType="TINYINT" />
    <result column="asset_type_dscr" property="asset_type_dscr" jdbcType="VARCHAR" />-->
    <result column="inventory_item_id" property="inventory_item_id" jdbcType="SMALLINT" />
    <result column="item_type" 	property="item_type" jdbcType="VARCHAR" />
    <result column="cr_user" 	property="cr_user" jdbcType="VARCHAR" />
    <result column="cr_time" 	property="cr_time" jdbcType="VARCHAR" />
    <result column="md_user" 	property="md_user" jdbcType="VARCHAR" />
    <result column="md_time" 	property="md_time" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    a.mat_no, a.mat_name, a.catg1_code, b.catg1_name, a.catg2_code, b.catg2_name, a.catg3_code, b.catg3_name,
    a.unit, a.ctrl_type, a.is_asset,  a.inventory_item_id,
    a.item_type, a.cr_user, a.cr_time, a.md_user, a.md_time
  </sql>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.foya.dao.mybatis.model.UTbInvMaterialExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from TB_INV_MATERIAL a
    left join TB_INV_CATEGORY b on b.catg1_code = b.catg1_code
                               and b.catg2_code = b.catg2_code
                               and b.catg3_code = b.catg3_code
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    select 
    <include refid="Base_Column_List" />
    from TB_INV_MATERIAL a
    left join TB_INV_CATEGORY b on b.catg1_code = b.catg1_code
                               and b.catg2_code = b.catg2_code
                               and b.catg3_code = b.catg3_code
    where a.mat_no = #{mat_no,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    delete from TB_INV_MATERIAL
    where mat_no = #{mat_no,jdbcType=VARCHAR}
  </delete>
  <delete id="deleteByExample" parameterType="com.foya.dao.mybatis.model.UTbInvMaterialExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    delete from TB_INV_MATERIAL
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.foya.noms.dto.inv.TbInvMaterialDTO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    insert into TB_INV_MATERIAL (mat_no, mat_name, catg1_code, 
      catg2_code, catg3_code, unit, 
      ctrl_type, is_asset, 
      inventory_item_id, item_type, cr_user, 
      cr_time, md_user, md_time
      )
    values (#{mat_no,jdbcType=VARCHAR}, #{mat_name,jdbcType=VARCHAR}, #{catg1_code,jdbcType=VARCHAR}, 
      #{catg2_code,jdbcType=VARCHAR}, #{catg3_code,jdbcType=VARCHAR}, #{unit,jdbcType=VARCHAR}, 
      #{ctrl_type,jdbcType=CHAR}, #{is_asset,jdbcType=BIT},  
      #{inventory_item_id,jdbcType=SMALLINT}, #{item_type,jdbcType=VARCHAR}, #{cr_user,jdbcType=VARCHAR}, 
      #{cr_time,jdbcType=VARCHAR}, #{md_user,jdbcType=VARCHAR}, #{md_time,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.foya.noms.dto.inv.TbInvMaterialDTO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    insert into TB_INV_MATERIAL
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="mat_no != null" >
        mat_no,
      </if>
      <if test="mat_name != null" >
        mat_name,
      </if>
      <if test="catg1_code != null" >
        catg1_code,
      </if>
      <if test="catg2_code != null" >
        catg2_code,
      </if>
      <if test="catg3_code != null" >
        catg3_code,
      </if>
      <if test="unit != null" >
        unit,
      </if>
      <if test="ctrl_type != null" >
        ctrl_type,
      </if>
      <if test="is_asset != null" >
        is_asset,
      </if>
      
      <if test="inventory_item_id != null" >
        inventory_item_id,
      </if>
      <if test="item_type != null" >
        item_type,
      </if>
      <if test="cr_user != null" >
        cr_user,
      </if>
      <if test="cr_time != null" >
        cr_time,
      </if>
      <if test="md_user != null" >
        md_user,
      </if>
      <if test="md_time != null" >
        md_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="mat_no != null" >
        #{mat_no,jdbcType=VARCHAR},
      </if>
      <if test="mat_name != null" >
        #{mat_name,jdbcType=VARCHAR},
      </if>
      <if test="catg1_code != null" >
        #{catg1_code,jdbcType=VARCHAR},
      </if>
      <if test="catg2_code != null" >
        #{catg2_code,jdbcType=VARCHAR},
      </if>
      <if test="catg3_code != null" >
        #{catg3_code,jdbcType=VARCHAR},
      </if>
      <if test="unit != null" >
        #{unit,jdbcType=VARCHAR},
      </if>
      <if test="ctrl_type != null" >
        #{ctrl_type,jdbcType=CHAR},
      </if>
      <if test="is_asset != null" >
        #{is_asset,jdbcType=BIT},
      </if>
      
      <if test="inventory_item_id != null" >
        #{inventory_item_id,jdbcType=SMALLINT},
      </if>
      <if test="item_type != null" >
        #{item_type,jdbcType=VARCHAR},
      </if>
      <if test="cr_user != null" >
        #{cr_user,jdbcType=VARCHAR},
      </if>
      <if test="cr_time != null" >
        #{cr_time,jdbcType=VARCHAR},
      </if>
      <if test="md_user != null" >
        #{md_user,jdbcType=VARCHAR},
      </if>
      <if test="md_time != null" >
        #{md_time,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.foya.dao.mybatis.model.UTbInvMaterialExample" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    select count(*) from TB_INV_MATERIAL
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    update TB_INV_MATERIAL
    <set >
      <if test="record.mat_no != null" >
        mat_no = #{record.mat_no,jdbcType=VARCHAR},
      </if>
      <if test="record.mat_name != null" >
        mat_name = #{record.mat_name,jdbcType=VARCHAR},
      </if>
      <if test="record.catg1_code != null" >
        catg1_code = #{record.catg1_code,jdbcType=VARCHAR},
      </if>
      <if test="record.catg2_code != null" >
        catg2_code = #{record.catg2_code,jdbcType=VARCHAR},
      </if>
      <if test="record.catg3_code != null" >
        catg3_code = #{record.catg3_code,jdbcType=VARCHAR},
      </if>
      <if test="record.unit != null" >
        unit = #{record.unit,jdbcType=VARCHAR},
      </if>
      <if test="record.ctrl_type != null" >
        ctrl_type = #{record.ctrl_type,jdbcType=CHAR},
      </if>
      <if test="record.is_asset != null" >
        is_asset = #{record.is_asset,jdbcType=BIT},
      </if>
      
      <if test="record.inventory_item_id != null" >
        inventory_item_id = #{record.inventory_item_id,jdbcType=SMALLINT},
      </if>
      <if test="record.item_type != null" >
        item_type = #{record.item_type,jdbcType=VARCHAR},
      </if>
      <if test="record.cr_user != null" >
        cr_user = #{record.cr_user,jdbcType=VARCHAR},
      </if>
      <if test="record.cr_time != null" >
        cr_time = #{record.cr_time,jdbcType=VARCHAR},
      </if>
      <if test="record.md_user != null" >
        md_user = #{record.md_user,jdbcType=VARCHAR},
      </if>
      <if test="record.md_time != null" >
        md_time = #{record.md_time,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    update TB_INV_MATERIAL
    set mat_no = #{record.mat_no,jdbcType=VARCHAR},
      mat_name = #{record.mat_name,jdbcType=VARCHAR},
      catg1_code = #{record.catg1_code,jdbcType=VARCHAR},
      catg2_code = #{record.catg2_code,jdbcType=VARCHAR},
      catg3_code = #{record.catg3_code,jdbcType=VARCHAR},
      unit = #{record.unit,jdbcType=VARCHAR},
      ctrl_type = #{record.ctrl_type,jdbcType=CHAR},
      is_asset = #{record.is_asset,jdbcType=BIT},

      inventory_item_id = #{record.inventory_item_id,jdbcType=SMALLINT},
      item_type = #{record.item_type,jdbcType=VARCHAR},
      cr_user = #{record.cr_user,jdbcType=VARCHAR},
      cr_time = #{record.cr_time,jdbcType=VARCHAR},
      md_user = #{record.md_user,jdbcType=VARCHAR},
      md_time = #{record.md_time,jdbcType=VARCHAR}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.foya.noms.dto.inv.TbInvMaterialDTO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    update TB_INV_MATERIAL
    <set >
      <if test="mat_name != null" >
        mat_name = #{mat_name,jdbcType=VARCHAR},
      </if>
      <if test="catg1_code != null" >
        catg1_code = #{catg1_code,jdbcType=VARCHAR},
      </if>
      <if test="catg2_code != null" >
        catg2_code = #{catg2_code,jdbcType=VARCHAR},
      </if>
      <if test="catg3_code != null" >
        catg3_code = #{catg3_code,jdbcType=VARCHAR},
      </if>
      <if test="unit != null" >
        unit = #{unit,jdbcType=VARCHAR},
      </if>
      <if test="ctrl_type != null" >
        ctrl_type = #{ctrl_type,jdbcType=CHAR},
      </if>
      <if test="is_asset != null" >
        is_asset = #{is_asset,jdbcType=BIT},
      </if>
      
      <if test="inventory_item_id != null" >
        inventory_item_id = #{inventory_item_id,jdbcType=SMALLINT},
      </if>
      <if test="item_type != null" >
        item_type = #{item_type,jdbcType=VARCHAR},
      </if>
      <if test="cr_user != null" >
        cr_user = #{cr_user,jdbcType=VARCHAR},
      </if>
      <if test="cr_time != null" >
        cr_time = #{cr_time,jdbcType=VARCHAR},
      </if>
      <if test="md_user != null" >
        md_user = #{md_user,jdbcType=VARCHAR},
      </if>
      <if test="md_time != null" >
        md_time = #{md_time,jdbcType=VARCHAR},
      </if>
    </set>
    where mat_no = #{mat_no,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.foya.noms.dto.inv.TbInvMaterialDTO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 03 15:56:14 CST 2014.
    -->
    update TB_INV_MATERIAL
    set mat_name = #{mat_name,jdbcType=VARCHAR},
      catg1_code = #{catg1_code,jdbcType=VARCHAR},
      catg2_code = #{catg2_code,jdbcType=VARCHAR},
      catg3_code = #{catg3_code,jdbcType=VARCHAR},
      unit = #{unit,jdbcType=VARCHAR},
      ctrl_type = #{ctrl_type,jdbcType=CHAR},
      is_asset = #{is_asset,jdbcType=BIT},

      inventory_item_id = #{inventory_item_id,jdbcType=SMALLINT},
      item_type = #{item_type,jdbcType=VARCHAR},
      cr_user = #{cr_user,jdbcType=VARCHAR},
      cr_time = #{cr_time,jdbcType=VARCHAR},
      md_user = #{md_user,jdbcType=VARCHAR},
      md_time = #{md_time,jdbcType=VARCHAR}
    where mat_no = #{mat_no,jdbcType=VARCHAR}
  </update>
    <select id="selectMaterial"  resultMap="BaseResultMap">
  	SELECT
		*
		from TB_INV_MATERIAL
		order by mat_no
  </select>
  
  <select id="selectMaterialByCatgCode"  resultMap="BaseResultMap" parameterType="hashmap" >
  	SELECT
		mat_no,mat_name
		from TB_INV_MATERIAL
		where catg1_code = #{catgCode1,jdbcType=VARCHAR}
		<if test="catgCode2 != null" >
		and catg2_code = #{catgCode2,jdbcType=VARCHAR}
		</if>
		<if test="catgCode3 != null" >
		and catg3_code = #{catgCode3,jdbcType=VARCHAR}
		</if>
		<!--  group by mat_no,mat_name-->
		order by mat_no
  </select>
  
  <!-- 查詢結果 asset_type --> 
  <select id="searchMaterial" resultMap="BaseResultMap" parameterType="map">
  	SELECT 
  		m.mat_no, m.mat_name, m.catg1_code, (select catg1_name from TB_INV_CATEGORY where catg1_code=M.catg1_code 
  		and catg2_code=M.catg2_code and catg3_code=M.catg3_code) catg1_name, m.catg2_code, (select catg2_name from TB_INV_CATEGORY 
  		where catg1_code=M.catg1_code and catg2_code=M.catg2_code and catg3_code=M.catg3_code) catg2_name, 
  		m.catg3_code, (select catg3_name from TB_INV_CATEGORY 
  		where catg1_code=M.catg1_code and catg2_code=M.catg2_code and catg3_code=M.catg3_code) catg3_name, m.unit, 
  		m.ctrl_type,
  		case ctrl_type
  			when 'S' then 'SERIAL'
  			when 'V' then 'VOLUME'
  		end ctrl_type_dscr,
  		m.is_asset, 
  		case m.is_asset 
  			when '1' then '是'
  			when '0' then '否'
  		end is_asset_dscr,
    	m.inventory_item_id, m.item_type, m.cr_user, m.cr_time, m.md_user, m.md_time
	from TB_INV_MATERIAL M
	<!-- where 
	M.catg1_code = #{catgCode1,jdbcType=VARCHAR}
	<if test="catgCode2 != null and catgCode2 != ''" >
		and M.catg2_code = #{catgCode2,jdbcType=VARCHAR}		
	</if>
	<if test="catgCode3 != null and catgCode3 != ''" >
		and M.catg3_code = #{catgCode3,jdbcType=VARCHAR}		
	</if>
	<if test="matNo != null and matNo != ''" >
		and M.mat_no = #{matNo,jdbcType=VARCHAR}
	</if>-->
	
	<where>           
        <if test="catgCode1 != null and catgCode1 != ''" >
		and M.catg1_code = #{catgCode1,jdbcType=VARCHAR}
		
		</if>
      	<if test="catgCode2 != null and catgCode2 != ''" >
		and M.catg2_code = #{catgCode2,jdbcType=VARCHAR}
		
		</if>
		<if test="catgCode3 != null and catgCode3 != ''" >
		and M.catg3_code = #{catgCode3,jdbcType=VARCHAR}
		
		</if>
		<if test="matNo != null and matNo != ''" >
		and M.mat_no = #{matNo,jdbcType=VARCHAR}
		</if>
     </where>
	<if test="orderCatg1">
		Order by M.catg1_code DESC
	</if>  	
  </select>
</mapper>