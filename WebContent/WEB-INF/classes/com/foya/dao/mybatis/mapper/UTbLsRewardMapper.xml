<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.foya.dao.mybatis.mapper.UTbLsRewardMapper">
  <resultMap id="BaseResultMap" type="com.foya.dao.mybatis.model.TbLsReward">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 28 16:10:34 CST 2015.
    -->
    <id column="LS_NO" jdbcType="VARCHAR" property="LS_NO" />
    <result column="LS_VER" jdbcType="VARCHAR" property="LS_VER" />
    <result column="REWARD_TYPE" jdbcType="VARCHAR" property="REWARD_TYPE" />
    <result column="REWARD_ID" jdbcType="VARCHAR" property="REWARD_ID" />
    <result column="CUST_NAME" jdbcType="VARCHAR" property="CUST_NAME" />
    <result column="PHONE_NBR" jdbcType="VARCHAR" property="PHONE_NBR" />
    <result column="PRCING" jdbcType="VARCHAR" property="PRCING" />
    <result column="REWARD_QTY" jdbcType="DECIMAL" property="REWARD_QTY" />
    <result column="ESTIMATE_AMT" jdbcType="DECIMAL" property="ESTIMATE_AMT" />
    <result column="GET_DATE" jdbcType="TIMESTAMP" property="GET_DATE" />
    <result column="REWARD_RESN" jdbcType="VARCHAR" property="REWARD_RESN" />
    <result column="REWARD_DESC" jdbcType="VARCHAR" property="REWARD_DESC" />
    <result column="CR_USER" jdbcType="VARCHAR" property="CR_USER" />
    <result column="CR_TIME" jdbcType="TIMESTAMP" property="CR_TIME" />
    <result column="MD_USER" jdbcType="VARCHAR" property="MD_USER" />
    <result column="MD_TIME" jdbcType="TIMESTAMP" property="MD_TIME" />
  </resultMap>
  
    <resultMap id="LsRewardResultMap" type="com.foya.noms.dto.ls.TbLsRewardDTO">
    <id column="LS_NO" jdbcType="VARCHAR" property="LS_NO" />
    <result column="LS_VER" jdbcType="VARCHAR" property="LS_VER" />
    <result column="REWARD_TYPE" jdbcType="VARCHAR" property="REWARD_TYPE" />
    <result column="REWARD_ID" jdbcType="VARCHAR" property="REWARD_ID" />
    <result column="CUST_NAME" jdbcType="VARCHAR" property="CUST_NAME" />
    <result column="PHONE_NBR" jdbcType="VARCHAR" property="PHONE_NBR" />
    <result column="PRCING" jdbcType="VARCHAR" property="PRCING" />
    <result column="REWARD_QTY" jdbcType="DECIMAL" property="REWARD_QTY" />
    <result column="ESTIMATE_AMT" jdbcType="DECIMAL" property="ESTIMATE_AMT" />
    <result column="GET_DATE" jdbcType="TIMESTAMP" property="GET_DATE" />
    <result column="REWARD_RESN" jdbcType="VARCHAR" property="REWARD_RESN" />
    <result column="REWARD_DESC" jdbcType="VARCHAR" property="REWARD_DESC" />
    <result column="CR_USER" jdbcType="VARCHAR" property="CR_USER" />
    <result column="CR_TIME" jdbcType="TIMESTAMP" property="CR_TIME" />
    <result column="MD_USER" jdbcType="VARCHAR" property="MD_USER" />
    <result column="MD_TIME" jdbcType="TIMESTAMP" property="MD_TIME" />
  </resultMap>
  
  <select id="getLsRewardByLsNoMaxVer" parameterType="hashmap" resultMap="LsRewardResultMap">

    select 
    LS_NO, LS_VER, REWARD_TYPE, REWARD_ID, CUST_NAME, PHONE_NBR, PRCING, REWARD_QTY, 
    ESTIMATE_AMT, GET_DATE, REWARD_RESN, REWARD_DESC, CR_USER, CR_TIME, MD_USER, MD_TIME
    from TB_LS_REWARD
    where LS_NO =#{lsNo}
    <choose>
		    <when test="lsVer != null and lsVer != ''">
		      and LS_VER =#{lsVer} 
		    </when>
		    <otherwise>
			 and LS_VER=(SELECT MAX(CONVERT(INT, LS_VER)) FROM TB_LS_REWARD WHERE LS_NO=#{lsNo})
		    </otherwise>
	</choose>
   
    <if test="rewardType!=null and rewardType!=''">
       AND REWARD_TYPE=#{rewardType}
    </if>
  </select>
  
  
  <select id="getLsRewardByLsNoVer" parameterType="hashmap" resultMap="BaseResultMap">

    select 
    LS_NO, LS_VER, REWARD_TYPE, REWARD_ID, CUST_NAME, PHONE_NBR, PRCING, REWARD_QTY, 
    ESTIMATE_AMT, GET_DATE, REWARD_RESN, REWARD_DESC, CR_USER, CR_TIME, MD_USER, MD_TIME
    from TB_LS_REWARD
    where LS_NO =#{lsNo}
    <choose>
		    <when test="lsVer != null and lsVer != ''">
		      and LS_VER =#{lsVer} 
		    </when>
		    <otherwise>
			 and LS_VER=(SELECT MAX(CONVERT(INT, LS_VER)) FROM TB_LS_REWARD WHERE LS_NO=#{lsNo}) 
		    </otherwise>
	</choose>
   
    <if test="rewardType!=null and rewardType!=''">
       AND REWARD_TYPE=#{rewardType}
    </if>
  </select>
  
  
  <select id="getLsRewardAddedByAppSeq" parameterType="hashmap" resultMap="BaseResultMap">

    select 
    LS_NO, LS_VER, REWARD_TYPE, REWARD_ID, CUST_NAME, PHONE_NBR, PRCING, REWARD_QTY, 
    ESTIMATE_AMT, GET_DATE, REWARD_RESN, REWARD_DESC, CR_USER, CR_TIME, MD_USER, MD_TIME
    from TB_LS_REWARD_Added
    where app_seq =#{appSeq}
    <if test="rewardType!=null and rewardType!=''">
       AND REWARD_TYPE=#{rewardType}
    </if>
  </select>
  
  <select id = "selectMaxVerbyLsNo" parameterType="String" resultMap="BaseResultMap" >
  SELECT
	MAX (CONVERT(INT, LS_VER)) AS LS_VER
FROM
	TB_LS_REWARD
WHERE
	LS_NO = #{lsNo}
  </select>
  
</mapper>