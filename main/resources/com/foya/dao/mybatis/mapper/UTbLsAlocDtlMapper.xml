<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.foya.dao.mybatis.mapper.UTbLsAlocDtlMapper">
  <resultMap id="BaseResultMap" type="com.foya.noms.dto.ls.SiteAlocDetailDTO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Feb 09 17:47:27 CST 2015.
    -->
    <id column="ALOC_ID" jdbcType="VARCHAR" property="ALOC_ID" />
    <result column="ALOC_SET_ID" jdbcType="VARCHAR" property="ALOC_SET_ID" />
    <result column="SEQ_ID" jdbcType="DECIMAL" property="SEQ_ID" />
    <result column="FEQ_NAME" jdbcType="VARCHAR" property="FEQ_NAME" />
    <result column="FEQ_TYPE" jdbcType="VARCHAR" property="FEQ_TYPE" />
    <result column="EFF_DATE" jdbcType="TIMESTAMP" property="EFF_DATE" />
    <result column="END_DATE" jdbcType="TIMESTAMP" property="END_DATE" />
    <result column="ALOC_RATIO" jdbcType="DECIMAL" property="ALOC_RATIO" />
    <result column="CR_USER" jdbcType="VARCHAR" property="CR_USER" />
    <result column="CR_TIME" jdbcType="TIMESTAMP" property="CR_TIME" />
    <result column="MD_USER" jdbcType="VARCHAR" property="MD_USER" />
    <result column="MD_TIME" jdbcType="TIMESTAMP" property="MD_TIME" />
    
    <result column="LOC_TYPE" jdbcType="VARCHAR" property="LOC_TYPE" />
    <result column="ALOC_ITEM" jdbcType="VARCHAR" property="alocItem" />
    <result column="CARRIERS_ID" jdbcType="VARCHAR" property="CARRIERS_ID" />
  </resultMap>
  
  <select id="selectSiteAloc4New" resultMap="BaseResultMap">
	
select a.LOC_TYPE,a.ALOC_ITEM,a.CARRIERS_ID,b.* from TB_LS_ALOC a, TB_LS_Aloc_dtl b  where a.ALOC_SET_ID=b.ALOC_SET_ID
	     AND a.SITE_NBR=#{SITE_NBR} and a.LOC_TYPE=#{LOC_TYPE} 
	     <if test="ALOC_ITEM != null and ALOC_ITEM != ''" >
	     AND a.ALOC_ITEM in 
	      <foreach collection="ALOC_ITEM" item="item" open="(" close=")" separator=",">
		      #{item}
		  </foreach>
	   
	    </if>
	    <if test="CARRIERS_ID != null and CARRIERS_ID != ''" >
	     AND A.CARRIERS_ID = #{CARRIERS_ID}
	    </if>
	    
	    <if test="FEQ_TYPE != null and FEQ_TYPE != ''" >
	     AND b.FEQ_TYPE in 
	      <foreach collection="FEQ_TYPE" item="item" open="(" close=")" separator=",">
		      #{item}
		  </foreach>
	   
	    </if>
	   
	    <if test="CHECKDATE != null and CHECKDATE != ''" >
	    <![CDATA[       
	     	AND (#{CHECKDATE} >=B.EFF_DATE and (B.END_DATE is null or #{CHECKDATE}<=B.END_DATE) )
	    ]]>
	    </if>
	    <if test="FEQ_NAME != null and FEQ_NAME.length > 0">
	     	AND b.FEQ_NAME IN	
		     <foreach collection="FEQ_NAME" item="item" open="(" close=")" separator=",">
		      #{item}
		      </foreach>
	     </if>
	     order by b.seq_id,a.ALOC_ITEM,b.FEQ_TYPE
  </select>
  
  <select id="findExchSiteAlocExitByCond" resultMap="BaseResultMap">
  select a.LOC_TYPE,a.ALOC_ITEM,a.CARRIERS_ID,b.* 
    from TB_LS_ALOC a, TB_LS_Aloc_dtl b , TB_LS_RES_EXCH_aloc c
   where a.ALOC_SET_ID=b.ALOC_SET_ID
     and c.aloc_id = b.aloc_id
     and c.ls_no = #{lsNo} 
     and c.ls_ver = #{lsVer} 
     and c.LOCATION_ID = #{mainLocId} 
     and c.EXCH_LOC_ID = #{exchLocId} 
  </select>
  
  <select id="findExchSiteAlocAddedExitByCond" resultMap="BaseResultMap">
  select a.LOC_TYPE,a.ALOC_ITEM,a.CARRIERS_ID,b.* 
    from TB_LS_ALOC a, TB_LS_Aloc_dtl b , TB_LS_RES_EXCH_aloc_added c
   where a.ALOC_SET_ID=b.ALOC_SET_ID
     and c.aloc_id = b.aloc_id
     and c.app_Seq = #{appSeq} 
     and c.LOCATION_ID = #{mainLocId} 
     and c.EXCH_LOC_ID = #{exchLocId} 
  </select>
</mapper>