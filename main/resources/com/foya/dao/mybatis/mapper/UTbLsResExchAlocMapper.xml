<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.foya.dao.mybatis.mapper.UTbLsResExchAlocMapper" >
  <resultMap id="BaseResultMap" type="com.foya.dao.mybatis.model.TbLsResExchAloc" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Feb 09 16:56:43 CST 2015.
    -->
    <result column="LS_NO" property="LS_NO" jdbcType="VARCHAR" />
    <result column="LS_VER" property="LS_VER" jdbcType="VARCHAR" />
    <result column="LOCATION_ID" property="LOCATION_ID" jdbcType="VARCHAR" />
    <result column="EXCH_LOC_ID" property="EXCH_LOC_ID" jdbcType="VARCHAR" />
    <result column="SITE_ID" property="SITE_ID" jdbcType="VARCHAR" />
    <result column="ALOC_ITEM" property="ALOC_ITEM" jdbcType="VARCHAR" />
    <result column="ALOC_ID" property="ALOC_ID" jdbcType="VARCHAR" />
    <result column="CR_USER" property="CR_USER" jdbcType="VARCHAR" />
    <result column="CR_TIME" property="CR_TIME" jdbcType="TIMESTAMP" />
    <result column="MD_USER" property="MD_USER" jdbcType="VARCHAR" />
    <result column="MD_TIME" property="MD_TIME" jdbcType="TIMESTAMP" />
  </resultMap>
 
	<select id="getLsResExchAlocByLsNoVer" resultMap="BaseResultMap" parameterType="String">
	SELECT R.*
	  FROM TB_LS_RES_EXCH_ALOC R  WHERE R.LS_NO = #{lsNo}
	  <if test="locId!=null and locId!=''">
	  	AND R.LOCATION_ID = #{locId}
	 </if>
	  <choose>
		    <when test="lsVer != null and lsVer != ''">
		      and r.ls_ver =#{lsVer} 
		    </when>
		    <otherwise>
		   	 and r.ls_ver = (Select max(CONVERT(INT, LS_VER)) from TB_LS_RES_EXCH where ls_no = #{lsNo}<if test="locId!=null and locId!=''"> and LOCATION_ID = #{locId}</if>)
		    </otherwise>
		</choose>
	 
	</select>
	
	
	<select id="getMaxVer" resultMap="BaseResultMap" parameterType="String">
	
	SELECT
		MAX (CONVERT(INT, LS_VER)) AS LS_VER
	FROM
		TB_LS_RES_EXCH_ALOC
	WHERE
		ls_no = #{lsNo}
	</select>
</mapper>