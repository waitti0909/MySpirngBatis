<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.foya.dao.mybatis.mapper.UTbSiteMainMapper">
  <resultMap id="BaseResultMap" type="com.foya.noms.dto.st.SiteDTO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 22 10:13:29 CST 2014.
    -->
    <id column="SITE_ID" jdbcType="VARCHAR" property="SITE_ID" />
    <result column="FEQ_ID" jdbcType="VARCHAR" property="FEQ_ID" />
    <result column="SR_ID" jdbcType="VARCHAR" property="SR_ID" />
    <result column="BTS_SITE_ID" jdbcType="VARCHAR" property="BTS_SITE_ID" />
    <result column="SITE_NAME" jdbcType="VARCHAR" property="SITE_NAME" />
    <result column="LOCATION_ID" jdbcType="VARCHAR" property="LOCATION_ID" />
    <result column="PURPOSE" jdbcType="VARCHAR" property="PURPOSE" />
    <result column="EQP_TYPE_ID" jdbcType="VARCHAR" property="EQP_TYPE_ID" />
    <result column="EQP_MODEL_ID" jdbcType="VARCHAR" property="EQP_MODEL_ID" />
    <result column="COVERAGE_TYPE" jdbcType="CHAR" property="COVERAGE_TYPE" />
    <result column="COVERAGE_IN_FLOOR" jdbcType="VARCHAR" property="COVERAGE_IN_FLOOR" />
    <result column="BTS_CONFIG" jdbcType="VARCHAR" property="BTS_CONFIG" />
    <result column="DONOR_SITE" jdbcType="VARCHAR" property="DONOR_SITE" />
    <result column="FEEDERLESS" jdbcType="VARCHAR" property="FEEDERLESS" />
    <result column="MASTER_SITE" jdbcType="VARCHAR" property="MASTER_SITE" />
    <result column="CLUSTER" jdbcType="VARCHAR" property="CLUSTER" />
    <result column="RNC_BTS" jdbcType="VARCHAR" property="RNC_BTS" />
    <result column="NIOS_RPT_STATUS" jdbcType="VARCHAR" property="NIOS_RPT_STATUS" />
    <result column="CELL_STATUS" jdbcType="VARCHAR" property="CELL_STATUS" />
    <result column="OMCU_OBJ" jdbcType="VARCHAR" property="OMCU_OBJ" />
    <result column="SPEED_UPLOAD" jdbcType="VARCHAR" property="SPEED_UPLOAD" />
    <result column="SPEED_DOWNLOAD" jdbcType="VARCHAR" property="SPEED_DOWNLOAD" />
    <result column="POWER" jdbcType="VARCHAR" property="POWER" />
    <result column="CST_ID_CARD_NUM" jdbcType="VARCHAR" property="CST_ID_CARD_NUM" />
    <result column="CST_MOBILE" jdbcType="VARCHAR" property="CST_MOBILE" />
    <result column="CST_ID" jdbcType="VARCHAR" property="CST_ID" />
    <result column="SITE_STATUS" jdbcType="VARCHAR" property="SITE_STATUS" />
    <result column="COVERAGE_INDOOR" jdbcType="CHAR" property="COVERAGE_INDOOR" />
    <result column="HIDDEN" jdbcType="CHAR" property="HIDDEN" />
    <result column="NOIS_ON_AIR" jdbcType="CHAR" property="NOIS_ON_AIR" />
    <result column="L2_SWITCH" jdbcType="CHAR" property="l2_SWITCH" />
    <result column="INTEGRATED_DATE" jdbcType="TIMESTAMP" property="INTEGRATED_DATE" />
    <result column="ONAIR_DATE" jdbcType="TIMESTAMP" property="ONAIR_DATE" />
    <result column="DUMP_DATE" jdbcType="TIMESTAMP" property="DUMP_DATE" />
    <result column="SUSPEND_DATE" jdbcType="TIMESTAMP" property="SUSPEND_DATE" />
    <result column="RESTORE_DATE" jdbcType="TIMESTAMP" property="RESTORE_DATE" />
    <result column="LON" jdbcType="DECIMAL" property="LON" />
    <result column="LAT" jdbcType="DECIMAL" property="LAT" />
    <result column="CONSTR_KO_DATE" jdbcType="TIMESTAMP" property="CONSTR_KO_DATE" />
    <result column="CONSTR_DONE_DATE" jdbcType="TIMESTAMP" property="CONSTR_DONE_DATE" />
    <result column="SMR_READY_DATE" jdbcType="TIMESTAMP" property="SMR_READY_DATE" />
    <result column="UPS_READY_DATE" jdbcType="TIMESTAMP" property="UPS_READY_DATE" />
    <result column="AC_READY_DATE" jdbcType="TIMESTAMP" property="AC_READY_DATE" />
    <result column="DYNAMO_READY_DATE" jdbcType="TIMESTAMP" property="DYNAMO_READY_DATE" />
    <result column="ADM_READY_DATE" jdbcType="TIMESTAMP" property="ADM_READY_DATE" />
    <result column="POWER_READY_DATE" jdbcType="TIMESTAMP" property="POWER_READY_DATE" />
    <result column="TRANS_READY_DATE" jdbcType="TIMESTAMP" property="TRANS_READY_DATE" />
    <result column="CPL_NO" jdbcType="VARCHAR" property="CPL_NO" />
    <result column="PERMIT_NO" jdbcType="VARCHAR" property="PERMIT_NO" />
    <result column="LICENSE_NO" jdbcType="VARCHAR" property="LICENSE_NO" />
    <result column="CR_USER" jdbcType="VARCHAR" property="CR_USER" />
    <result column="CR_TIME" jdbcType="TIMESTAMP" property="CR_TIME" />
    <result column="MD_USER" jdbcType="VARCHAR" property="MD_USER" />
    <result column="MD_TIME" jdbcType="TIMESTAMP" property="MD_TIME" />
    
    <result column="EQP_NAME" jdbcType="VARCHAR" property="eqpName" />
    <result column="FEQ_NAME" jdbcType="VARCHAR" property="feqName" />
    <result column="LOC_NAME" jdbcType="VARCHAR" property="locName" />
    <result column="LOC_ADDR" jdbcType="VARCHAR" property="locAddr" />
    <result column="LOC_ZIP" jdbcType="VARCHAR" property="locZip" />
    <result column="LOC_ROAD" jdbcType="VARCHAR" property="locRoad" />
    <result column="EQP_MODEL" jdbcType="VARCHAR" property="eqpModel" />
    <result column="SIGN_DATE" jdbcType="TIMESTAMP" property="signDate" />
    
    
    <result column="MAINT_AREA" jdbcType="VARCHAR" property="maintArea" />
    <result column="CITY" jdbcType="VARCHAR" property="locCity" />
    <result column="AREA" jdbcType="VARCHAR" property="locArea" />
    
    <result column="VILLAGE" jdbcType="VARCHAR" property="locVillage" />
    <result column="ADJACENT" jdbcType="VARCHAR" property="locAdjacent" />
    <result column="LANE" jdbcType="VARCHAR" property="locLane" />
    <result column="ALLEY" jdbcType="VARCHAR" property="locAlley" />
    <result column="SUB_ALLEY" jdbcType="VARCHAR" property="locSub_Alley" />
    <result column="DOOR_NO" jdbcType="VARCHAR" property="locDoor_No" />
    <result column="DOOR_NO_EX" jdbcType="VARCHAR" property="locDoor_No_Ex" />
    <result column="FLOOR" jdbcType="VARCHAR" property="locFloor" />
    <result column="FLOOR_EX" jdbcType="VARCHAR" property="locFloor_Ex" />
    <result column="ROOM" jdbcType="VARCHAR" property="locRoom" />
    <result column="ADD_OTHER" jdbcType="VARCHAR" property="locAdd_Other" />
  </resultMap>
 
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 22 10:13:29 CST 2014.
    -->
    SITE_ID, FEQ_ID, SR_ID, BTS_SITE_ID, SITE_NAME, LOCATION_ID, PURPOSE, EQP_TYPE_ID, 
    EQP_MODEL_ID, COVERAGE_TYPE, BTS_CONFIG, DONOR_SITE, FEEDERLESS, MASTER_SITE, CLUSTER, 
    RNC_BTS, NIOS_RPT_STATUS, CELL_STATUS, OMCU_OBJ, SPEED_UPLOAD, SPEED_DOWNLOAD, POWER, 
    CST_ID_CARD_NUM, CST_MOBILE, CST_ID, SITE_STATUS, COVERAGE_INDOOR, HIDDEN, NOIS_ON_AIR, 
    L2_SWITCH, CR_USER, CR_TIME, MD_USER, MD_TIME
  </sql>

  <select id="selectWorkSiteList" resultMap="BaseResultMap">
    select SITE_ID,BTS_SITE_ID,SITE_NAME,siteFeq.FEQ_NAME FEQ_NAME,siteMain.FEQ_ID,eqpType.EQP_NAME  EQP_NAME,SITE_STATUS ,siteMain.LOCATION_ID LOCATION_ID,
    location.LOC_NAME LOC_NAME,location.addr LOC_ADDR,location.zip LOC_ZIP,siteMain.EQP_TYPE_ID EQP_TYPE_ID,location.maint_area MAINT_AREA,
    siteMain.LON, siteMain.LAT, siteMain.COVERAGE_IN_FLOOR , siteMain.CLUSTER,
    location.CITY, location.AREA, location.VILLAGE, location.ADJACENT, location.ROAD LOC_ROAD, location.LANE, location.ALLEY, location.SUB_ALLEY, 
    location.DOOR_NO, location.DOOR_NO_EX, location.FLOOR, location.FLOOR_EX, location.ROOM, location.ADD_OTHER
	from TB_SITE_MAIN siteMain
	left outer join TB_COM_EQP_TYPE eqpType
	on siteMain.EQP_TYPE_ID = eqpType.EQP_TYPE_ID
	left outer join TB_COM_SITE_FEQ siteFeq
	on siteMain.FEQ_ID = siteFeq.FEQ_ID
	left outer join TB_SITE_LOCATION location
	on siteMain.LOCATION_ID = location.LOCATION_ID
	<where>
		<if test="btsSiteId!=null and btsSiteId!=''">
			and BTS_SITE_ID = #{btsSiteId}
		</if>
		<if test="siteName!=null and siteName!=''">
			and SITE_NAME like '%'+#{siteName}+'%'
		</if>
		<if test="feqName!=null and feqName!=''">
			and siteMain.FEQ_ID = #{feqName}
		</if>
		<if test="eqpName!=null and eqpName!=''">
			and siteMain.EQP_TYPE_ID = #{eqpName}
		</if>
		<if test="siteCity !=null and siteCity!=''">
			and CITY = #{siteCity}
		</if>
		<if test="siteTown !=null and siteTown!=''">
			and AREA = #{siteTown}
		</if>
		<if test="siteStatus !=null and siteStatus !=''">
			and SITE_STATUS = #{siteStatus}
		</if>
		<if test="feederless !=null and feederless !=''">
			and FEEDERLESS = #{feederless}
		</if>
		<if test="eqpTypeNotIn !=null and eqpTypeNotIn !=''">
			and siteMain.EQP_TYPE_ID NOT IN  ('M','H','C')
		</if>
		<if test="siteStatus !=null and siteStatus !=''">
			and siteMain.SITE_STATUS = #{siteStatus}
		</if>
		<if test="locationId !=null and locationId !=''">
			and siteMain.LOCATION_ID = #{locationId}
		</if>
		<if test="siteType !=null and siteType !=''">
			<choose>
				<when test="siteType == 'site'">
					and siteMain.EQP_TYPE_ID NOT IN  ('M','H','C')
				</when>
				<otherwise>
					and siteMain.EQP_TYPE_ID  IN  ('M','H','C')
				</otherwise>
			</choose>
		</if>
	</where>
  </select>
  <select id="selectSiteByLocationId" resultMap="BaseResultMap">
  	select main.SITE_ID ,main.BTS_SITE_ID,main.SITE_STATUS,loc.ROAD LOC_ROAD,eqpType.EQP_NAME EQP_NAME,
		eqpModel.EQP_MODEL EQP_MODEL,main.COVERAGE_TYPE,main.SPEED_UPLOAD,main.SPEED_DOWNLOAD,
		main.BTS_CONFIG,main.DONOR_SITE,main.FEEDERLESS,main.MASTER_SITE,main.HIDDEN,
		main.COVERAGE_INDOOR,main.NOIS_ON_AIR,main.L2_SWITCH,main.FEQ_ID,main.RNC_BTS,feq.FEQ_NAME FEQ_NAME,ls.SIGN_DATE,
		main.INTEGRATED_DATE,main.ONAIR_DATE,main.SUSPEND_DATE,main.RESTORE_DATE,main.COVERAGE_IN_FLOOR
	from TB_SITE_MAIN main
	left outer join TB_SITE_LOCATION loc
	on main.LOCATION_ID= loc.LOCATION_ID
	left outer join TB_COM_EQP_TYPE eqpType
	on main.EQP_TYPE_ID = eqpType.EQP_TYPE_ID
	left outer join TB_COM_EQP_MODEL eqpModel
	on main.EQP_MODEL_ID = eqpModel.EQP_MODEL_ID
	left outer join TB_COM_SITE_FEQ feq
	on main.FEQ_ID= feq.FEQ_ID
	left outer join TB_LS_SITE ls
	on ls.LS_NO = (select TOP(1) a.LS_NO 
						from TB_LS_SITE a 
						left join TB_LS_MAIN b
						on a.LS_NO = b.LS_NO 
						where main.SITE_ID = a.SITE_ID and b.LS_STATUS=1 
						order by b.SIGN_DATE desc)
	where main.LOCATION_ID = #{locationId} and main.SITE_STATUS != 'S11'
  </select>
  
  <select id="selectSiteBySiteId" resultMap="BaseResultMap">
  	select 
  		main.*,
  	loc.ROAD LOC_ROAD,eqpType.EQP_NAME EQP_NAME,
		eqpModel.EQP_MODEL EQP_MODEL,feq.FEQ_NAME FEQ_NAME,ls.SIGN_DATE
	from TB_SITE_MAIN main
	left outer join TB_SITE_LOCATION loc
	on main.LOCATION_ID= loc.LOCATION_ID
	left outer join TB_COM_EQP_TYPE eqpType
	on main.EQP_TYPE_ID = eqpType.EQP_TYPE_ID
	left outer join TB_COM_EQP_MODEL eqpModel
	on main.EQP_MODEL_ID = eqpModel.EQP_MODEL_ID
	left outer join TB_COM_SITE_FEQ feq
	on main.FEQ_ID= feq.FEQ_ID
	left outer join TB_LS_SITE ls
	on ls.LS_NO = (select TOP(1) a.LS_NO 
						from TB_LS_SITE a 
						left join TB_LS_MAIN b
						on a.LS_NO = b.LS_NO 
						where main.SITE_ID = a.SITE_ID and b.LS_STATUS=1 
						order by b.SIGN_DATE desc)
	where main.SITE_ID = #{siteId}
  </select>
  <select id="selectSiteMainByLocid" resultMap="BaseResultMap">
		select main.BTS_SITE_ID,main.SITE_STATUS,main.COVERAGE_TYPE,main.SPEED_UPLOAD,
		main.SPEED_DOWNLOAD, main.BTS_CONFIG,main.DONOR_SITE,main.FEEDERLESS
		FROM TB_SITE_LINE_SITE_DATA lineSiteData 
		left outer join TB_SITE_MAIN main 
		on lineSiteData.SITE_ID=main.SITE_ID
		where lineSiteData.LOC_ID= #{locId}
  </select>
  
  
  <select id="selectSiteMainByLocIdSiteStatus" resultMap="BaseResultMap">
		select main.*,
		feq.feq_name as FEQ_NAME
		FROM TB_SITE_MAIN main,TB_COM_SITE_FEQ feq 
		where main.FEQ_ID=feq.FEQ_ID and main.location_Id = #{locId}
		<if test="siteStatusList != null and siteStatusList.length > 0">
	     AND main.SITE_STATUS IN	
		   <foreach collection="siteStatusList" item="item" open="(" close=")" separator=",">
		      #{item}
		    </foreach>
	    </if>    	  
  </select>
 <select id="selectSiteMainByLocIdSiteIdStatus" resultMap="BaseResultMap">
		select main.*,
		feq.feq_name as FEQ_NAME
		FROM TB_SITE_MAIN main,TB_COM_SITE_FEQ feq 
		where main.FEQ_ID=feq.FEQ_ID and main.location_Id = #{locId}
		<if test="siteStatusList != null and siteStatusList.length > 0">
	     AND main.SITE_STATUS IN	
		   <foreach collection="siteStatusList" item="item" open="(" close=")" separator=",">
		      #{item}
		    </foreach>
	    </if>
	    <if test="siteIdList != null and siteIdList.size > 0">
	     AND main.SITE_ID NOT IN	
		   <foreach collection="siteIdList" item="item" open="(" close=")" separator=",">
		      #{item}
		    </foreach>
	    </if>		     	  
  </select>
  <select id="selectSiteMainByBtsSiteId" resultMap="BaseResultMap">
		select site_id
		FROM TB_SITE_MAIN
		where bts_site_id=#{btsSiteId}
		and site_status in ('S01','S02','S03','S04','S05','S06','S07','S08')
  </select>
  
  
  <select id="selectSiteMainBySiteIdList" resultMap="BaseResultMap">
		select main.*,
		feq.feq_name as FEQ_NAME
		FROM TB_SITE_MAIN main,TB_COM_SITE_FEQ feq 
		where main.FEQ_ID=feq.FEQ_ID 
		<if test="siteIdList != null and siteIdList.length > 0">
	     AND main.site_id IN	
		   <foreach collection="siteIdList" item="item" open="(" close=")" separator=",">
		      #{item}
		    </foreach>
	    </if>    	  
  </select>
  
  
 </mapper>