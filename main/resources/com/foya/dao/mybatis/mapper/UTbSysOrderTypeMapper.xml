<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.foya.dao.mybatis.mapper.UTbSysOrderTypeMapper" >
  <resultMap id="BaseResultMap" type="com.foya.noms.dto.system.OrderTypeDTO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 04 16:24:13 CST 2014.
    -->
    <id column="OD_TYPE_ID" property="OD_TYPE_ID" jdbcType="VARCHAR" />
    <result column="OD_TYPE_NAME" property="OD_TYPE_NAME" jdbcType="VARCHAR" />
    <result column="SHOW_PAGES" property="SHOW_PAGES" jdbcType="VARCHAR" />
    <result column="DEPT_DESC" property="DEPT_DESC" jdbcType="VARCHAR" />
    <result column="DEPT_KEY" property="DEPT_KEY" jdbcType="VARCHAR" />
    <result column="MEMO" property="MEMO" jdbcType="VARCHAR" />
    
    <result column="WK_TYPE_ID" property="workTypeId" jdbcType="VARCHAR" />
    <result column="OD_SEQ" property="orderSeq" jdbcType="INTEGER" />
  </resultMap>
  
  <!-- 以作業類別找工單類型 -->
  <select id="selectOrderByWorkType" resultMap="BaseResultMap">
  	select ot.*, wot.WK_TYPE_ID, wot.OD_SEQ from TB_SYS_ORDER_TYPE ot 
	join TB_SYS_WORK_ORDER_TYPE wot on wot.OD_TYPE_ID = ot.OD_TYPE_ID
	where wot.WK_TYPE_ID = #{wkTypeId}
	order by wot.OD_SORT, wot.OD_SEQ
  </select>
  
  <select id="selectOrderTypeByWorkTypeId" resultMap="BaseResultMap" parameterType="map">
  	select workOrderType.WK_TYPE_ID WK_TYPE_ID,workOrderType.OD_SEQ OD_SEQ,
  		workOrderType.OD_TYPE_ID OD_TYPE_ID,orderType.DEPT_KEY
  		
	from TB_SYS_ORDER_TYPE orderType
	inner join  TB_SYS_WORK_ORDER_TYPE workOrderType 
	on orderType.OD_TYPE_ID = workOrderType.OD_TYPE_ID
	
	where workOrderType.WK_TYPE_ID = #{workTypeId} 	
	<choose>
		<when test="odrSeq == null || odrSeq == '' ">
			and workOrderType.OD_SEQ != 99
		</when>
		<otherwise>
			and workOrderType.OD_SEQ = #{odrSeq}
		</otherwise>
	</choose>		
    order by workOrderType.OD_SORT, workOrderType.OD_SEQ
  </select>
  
  <select id="selectOrderTypesForBuild" resultMap="BaseResultMap">
  	select wot.OD_TYPE_ID, ot.OD_TYPE_NAME from TB_SYS_ORDER_TYPE ot
	join TB_SYS_WORK_ORDER_TYPE wot on wot.OD_TYPE_ID = ot.OD_TYPE_ID
	where wot.WK_TYPE_ID not in ('NSR', 'SH') 
	group by wot.od_type_id, ot.OD_TYPE_NAME
  </select>
  
</mapper>