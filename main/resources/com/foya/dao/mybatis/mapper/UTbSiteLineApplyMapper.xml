<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.foya.dao.mybatis.mapper.UTbSiteLineApplyMapper" >
  <resultMap id="BaseResultMap" type="com.foya.noms.dto.st.line.SiteLineApplyDTO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jan 08 14:40:28 CST 2015.
    -->
    <result column="APP_TYPE" jdbcType="VARCHAR" property="APP_TYPE" />
    <result column="APP_TIME" jdbcType="TIMESTAMP" property="APP_TIME" />
    <result column="APP_DEPT" jdbcType="VARCHAR" property="APP_DEPT" />
    <result column="APP_USER" jdbcType="VARCHAR" property="APP_USER" />
    <result column="APP_STATUS" jdbcType="VARCHAR" property="APP_STATUS" />
    <result column="LINE_STATUS" jdbcType="VARCHAR" property="LINE_STATUS" />
    <result column="ORDER_ID" jdbcType="VARCHAR" property="ORDER_ID" />
    <result column="VENDOR" jdbcType="VARCHAR" property="VENDOR" />
    <result column="LINE_PURPOSE" jdbcType="VARCHAR" property="LINE_PURPOSE" />
    <result column="LINE_TYPE" jdbcType="VARCHAR" property="LINE_TYPE" />
    <result column="LINE_SPEED" jdbcType="VARCHAR" property="LINE_SPEED" />
    <result column="USE_TYPE" jdbcType="VARCHAR" property="USE_TYPE" />
    <result column="O_LINE_ID" jdbcType="VARCHAR" property="o_LINE_ID" />
    <result column="LINE_ID" jdbcType="VARCHAR" property="LINE_ID" />
    <result column="A_LOC" jdbcType="VARCHAR" property="a_LOC" />
    <result column="A_EQP" jdbcType="VARCHAR" property="a_EQP" />
    <result column="A_PORT_POS" jdbcType="VARCHAR" property="a_PORT_POS" />
    <result column="B_LOC" jdbcType="VARCHAR" property="b_LOC" />
    <result column="B_EQP" jdbcType="VARCHAR" property="b_EQP" />
    <result column="B_PORT_POS" jdbcType="VARCHAR" property="b_PORT_POS" />
    <result column="RCP_NUM" jdbcType="VARCHAR" property="RCP_NUM" />
    <result column="RENT_END_DATE" jdbcType="VARCHAR" property="RENT_END_DATE" />
    <result column="CNS_DATE" jdbcType="VARCHAR" property="CNS_DATE" />
    <result column="START_DATE" jdbcType="VARCHAR" property="START_DATE" />
    <result column="END_DATE" jdbcType="VARCHAR" property="END_DATE" />
    <result column="MON_FEE" jdbcType="BIGINT" property="MON_FEE" />
    <result column="INS_FEE" jdbcType="BIGINT" property="INS_FEE" />
    <result column="B_TEL" jdbcType="BIGINT" property="b_TEL" />
    <result column="B_ADDR" jdbcType="VARCHAR" property="b_ADDR" />
    <result column="B_NAME" jdbcType="VARCHAR" property="b_NAME" />
    <result column="CNT_PSN" jdbcType="VARCHAR" property="CNT_PSN" />
    <result column="CNT_TEL" jdbcType="VARCHAR" property="CNT_TEL" />
    <result column="APP_DESC" jdbcType="VARCHAR" property="APP_DESC" />
    <result column="CR_USER" jdbcType="VARCHAR" property="CR_USER" />
    <result column="CR_TIME" jdbcType="TIMESTAMP" property="CR_TIME" />
    <result column="MD_USER" jdbcType="VARCHAR" property="MD_USER" />
    <result column="MD_TIME" jdbcType="TIMESTAMP" property="MD_TIME" />
    <result column="NET_CFG_DATE" jdbcType="TIMESTAMP" property="NET_CFG_DATE" />
    
    <result column="DEPT_NAME" jdbcType="VARCHAR" property="deptName" />
    <result column="SITE_ID" jdbcType="VARCHAR" property="siteId" />
    
    <result column="area" jdbcType="VARCHAR" property="area" />
    <result column="locNameA" jdbcType="VARCHAR" property="locNameA" />
    <result column="locAddrA" jdbcType="VARCHAR" property="locAddrA" />
    <result column="cntPsnA" jdbcType="VARCHAR" property="cntPsnA" />
    <result column="cntTelA" jdbcType="VARCHAR" property="cntTelA" />
    <result column="locAddrB" jdbcType="VARCHAR" property="locAddrB" />
    <result column="cntPsnB" jdbcType="VARCHAR" property="cntPsnB" />
    <result column="cntTelB" jdbcType="VARCHAR" property="cntTelB" />     
    <result column="APP_USER_NAME" jdbcType="VARCHAR" property="APP_USER_NAME" />
    <result column="A_SITE_NAME" jdbcType="VARCHAR" property="A_SITE_NAME" />
    <result column="B_SITE_NAME" jdbcType="VARCHAR" property="B_SITE_NAME" />
    <result column="A_SITE_ID" jdbcType="VARCHAR" property="A_SITE_ID" />
    <result column="B_SITE_ID" jdbcType="VARCHAR" property="B_SITE_ID" />
    <result column="MAINT_AREA" jdbcType="VARCHAR" property="MAINT_AREA" />
    <result column="A_LOC_NAME" jdbcType="VARCHAR" property="A_LOC_NAME" />
    <result column="A_ADDR" jdbcType="VARCHAR" property="A_ADDR" />
    <result column="A_CNT_PSN" jdbcType="VARCHAR" property="A_CNT_PSN" />
    <result column="A_CNT_NAME" jdbcType="VARCHAR" property="A_CNT_NAME" />
    <result column="A_CNT_TEL" jdbcType="VARCHAR" property="A_CNT_TEL" />
	<result column="B_LOC_NAME" jdbcType="VARCHAR" property="B_LOC_NAME" />
	<result column="B_CNT_PSN" jdbcType="VARCHAR" property="B_CNT_PSN" />
	<result column="B_CNT_NAME" jdbcType="VARCHAR" property="B_CNT_NAME" />
	<result column="B_CNT_TEL" jdbcType="VARCHAR" property="B_CNT_TEL" />
	<result column="LINE_SPEED_NAME" jdbcType="VARCHAR" property="LINE_SPEED_NAME" />
	<result column="WORK_TYPE" jdbcType="VARCHAR" property="WORK_TYPE" />
	<result column="APP_TYPE_NAME" jdbcType="VARCHAR" property="APP_TYPE_NAME" />
	<result column="EQP_NAME" jdbcType="VARCHAR" property="EQP_NAME" />
	<result column="LINE_NUMBER" jdbcType="VARCHAR" property="LINE_NUMBER" />
	
  </resultMap>
 <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 21 17:08:26 CST 2015.
    -->
    lineApply.APP_ID, lineApply.APP_TYPE, lineApply.APP_TIME, lineApply.APP_DEPT, lineApply.APP_USER, lineApply.APP_STATUS, lineApply.LINE_STATUS, lineApply.ORDER_ID, 
    lineApply.VENDOR, lineApply.LINE_PURPOSE, lineApply.LINE_TYPE, lineApply.LINE_SPEED, lineApply.USE_TYPE, lineApply.O_LINE_ID, lineApply.LINE_ID, lineApply.A_LOC, 
    lineApply.A_EQP, lineApply.A_PORT_POS, lineApply.B_LOC, lineApply.B_EQP, lineApply.B_PORT_POS, lineApply.RCP_NUM, lineApply.RENT_END_DATE, lineApply.CNS_DATE, lineApply.START_DATE, lineApply.NET_CFG_DATE,
    lineApply.END_DATE, lineApply.MON_FEE, lineApply.INS_FEE, lineApply.B_TEL, lineApply.B_ADDR, lineApply.B_NAME, lineApply.CNT_PSN, lineApply.CNT_TEL, lineApply.APP_DESC, lineApply.CHT_GE,lineApply.MD_TIME
  </sql>
  
  <select id="selectLineApply" resultMap="BaseResultMap">
  	select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />,
    dept.DEPT_NAME DEPT_NAME,
    prs.CHN_NM  APP_USER_NAME,
	prsB.CHN_NM  B_CNT_NAME,
	siteWork.WORK_TYPE,
	sysLookup.NAME APP_TYPE_NAME,
	siteEqp.EQP_NAME
    from TB_SITE_LINE_APPLY lineApply
	    left outer join TB_SITE_WORK_ORDER workOrder ON	
	    		lineApply.ORDER_ID = workOrder.ORDER_ID
	    left outer join TB_SITE_WORK siteWork ON 
	    		workOrder.WORK_ID  = siteWork.WORK_ID
	    left outer join TB_SITE_MAIN siteMain ON 
	    		siteWork.SITE_ID   = siteMain.SITE_ID
		left outer join TB_COM_EQP_TYPE siteEqp ON 
		        siteEqp.EQP_TYPE_ID = siteMain.EQP_TYPE_ID 		
	    left outer join TB_ORG_DEPT dept ON 
	    		lineApply.APP_DEPT = dept.DEPT_ID
	  	left outer join TB_AUTH_PERSONNEL prs ON 
	  			lineApply.APP_USER = prs.PSN_NO 
			AND lineApply.APP_DEPT = prs.DEPT_ID 
	  	left outer join TB_ORG_DEPT deptB ON 
	  			lineApply.APP_DEPT = deptB.DEPT_ID
		left outer join TB_AUTH_PERSONNEL prsB ON 
				lineApply.CNT_PSN  = prsB.PSN_NO 
	  	left outer join TB_SYS_LOOKUP sysLookup ON 
	  			sysLookup.TYPE     = 'LINE_APPLY_TYPE' 
	  	    AND lineApply.APP_TYPE = sysLookup.CODE
  		<where>
			<if test="orderId !=null and orderId!=''">
				and lineApply.ORDER_ID = #{orderId}
			</if>
			<if test="appId !=null and appId!=''">
				and lineApply.APP_ID = #{appId}
			</if>
			<if test="lineId !=null and lineId!=''">
				and lineApply.LINE_ID = #{lineId}
			</if>
			<if test="oLineId !=null and oLineId!=''">
				and lineApply.O_LINE_ID = #{oLineId}
			</if>
		</where>
  </select>
  
  
   <select id="selectlineAppleListByDeptId" resultMap="BaseResultMap" parameterType="list">
  	select 
  	DISTINCT
  	dept.DEPT_NAME ,lineApply.APP_DEPT
  	from TB_SITE_LINE_APPLY lineApply
  	left outer join TB_ORG_DEPT dept
  	on lineApply.APP_DEPT = dept.DEPT_ID
  	<if test="list != null and list.size()>0">
  	where lineApply.APP_DEPT in 
	  	<foreach collection="list" item="listItem" open="(" close=")" separator="," >
	      #{listItem}
	    </foreach>
    </if>
  </select>
  
  <select id="selectByConditions" resultMap="BaseResultMap">
    select DISTINCT
    lineApply.APP_ID, lineApply.APP_TYPE, lineApply.APP_TIME, lineApply.APP_DEPT, lineApply.APP_USER, lineApply.APP_STATUS, lineApply.LINE_STATUS,lineApply.ORDER_ID, sysLookup.NAME as APP_TYPE_NAME,
    lineApply.VENDOR, lineApply.LINE_PURPOSE, lineApply.LINE_TYPE, lineApply.LINE_SPEED, lineApply.USE_TYPE, lineApply.O_LINE_ID, lineApply.LINE_ID, lineApply.A_LOC, lineApply.NET_CFG_DATE,
    lineApply.A_EQP, lineApply.A_PORT_POS, lineApply.B_LOC, lineApply.B_EQP, lineApply.B_PORT_POS, lineApply.RCP_NUM, lineApply.RENT_END_DATE, lineApply.CNS_DATE, lineApply.START_DATE, 
    lineApply.END_DATE, lineApply.MON_FEE, lineApply.INS_FEE, lineApply.B_TEL, lineApply.B_ADDR, lineApply.B_NAME,lineApply.CNT_PSN,lineApply.CNT_TEL,lineApply.APP_DESC,dept.DEPT_NAME
    from TB_SITE_LINE_APPLY lineApply
    left outer join TB_ORG_DEPT dept
  	on lineApply.APP_DEPT = dept.DEPT_ID
  	left outer join TB_SYS_LOOKUP sysLookup  
	on sysLookup.TYPE  = 'LINE_APPLY_TYPE' 
    AND lineApply.APP_TYPE = sysLookup.CODE
   	<where>
		<if test="workId !=null and workId!=''">
			and lineApply.ORDER_ID = #{workId}
		</if>
		<if test="applicationId !=null and applicationId !=''">
			and lineApply.APP_ID = #{applicationId}
		</if>
		<if test="baseStationId !=null and baseStationId !=''">
			and lineApply.APP_ID in(SELECT APP_ID FROM TB_SITE_LINE_SITE_DATA siteData,TB_SITE_MAIN main where siteData.SITE_ID = main.SITE_ID and main.BTS_SITE_ID = #{baseStationId})
		</if>
		<if test="btsSiteName !=null and btsSiteName !=''">
			and lineApply.APP_ID in(SELECT APP_ID FROM TB_SITE_LINE_SITE_DATA siteData,TB_SITE_MAIN main where siteData.SITE_ID = main.SITE_ID and main.SITE_NAME like '%'+#{btsSiteName}+'%')
		</if>
		<if test="lineId !=null and lineId !=''">
			and lineApply.LINE_ID = #{lineId}
		</if>
		<if test="applyDept !=null and applyDept !=''">
			and lineApply.APP_DEPT = #{applyDept}
		</if>
		<if test="appleType !=null and appleType !=''">
			and lineApply.APP_TYPE = #{appleType}
		</if> 
		<if test="appleState !=null and appleState !=''">
			and lineApply.APP_STATUS = #{appleState}
		</if> 
		<if test="worksType !=null and worksType !=''">
			and lineApply.VENDOR = #{worksType}
		</if>		
		<if test="lineType != null and lineType !=''">
			and lineApply.LINE_STATUS = #{lineType}
		</if>
	</where>
  </select>
  
  <select id="selectLineApplyByAppId" resultMap="BaseResultMap">
    select 
    lineApply.APP_ID, lineApply.APP_TYPE, lineApply.APP_TIME, lineApply.APP_DEPT, lineApply.APP_USER, lineApply.APP_STATUS, lineApply.LINE_STATUS,lineApply.ORDER_ID, 
    lineApply.VENDOR, lineApply.LINE_PURPOSE, lineApply.LINE_TYPE, lineApply.LINE_SPEED, lineApply.USE_TYPE, lineApply.O_LINE_ID, lineApply.LINE_ID, lineApply.A_LOC, lineApply.NET_CFG_DATE,
    lineApply.A_EQP, lineApply.A_PORT_POS, lineApply.B_LOC, lineApply.B_EQP, lineApply.B_PORT_POS, lineApply.RCP_NUM, lineApply.RENT_END_DATE, lineApply.CNS_DATE, lineApply.START_DATE, 
    lineApply.END_DATE, lineApply.MON_FEE, lineApply.INS_FEE, lineApply.B_TEL, lineApply.B_ADDR, lineApply.B_NAME,lineApply.CNT_PSN,lineApply.CNT_TEL,lineApply.APP_DESC,dept.DEPT_NAME
    from TB_SITE_LINE_APPLY lineApply
    left outer join TB_ORG_DEPT dept
  	on lineApply.APP_DEPT = dept.DEPT_ID
    where lineApply.APP_ID=#{appId}
  </select>
  <select id="selectLineApplyByExcel" resultMap="BaseResultMap">
	select 
	siteLoc.MAINT_AREA as area,siteLocA.LOC_NAME as locNameA,siteLocA.ADDR as locAddrA,
	siteLocA.CNT_PSN as cntPsnA,siteLocA.CNT_TEL as cntTelA,lineSiteData.SITE_ID,
	siteLocB.ADDR as locAddrB,siteLocB.CNT_PSN as cntPsnB,siteLocB.CNT_TEL as cntTelB,
	lineApply.LINE_SPEED,lineApply.APP_TIME,lineApply.LINE_ID
	 from TB_SITE_LINE_APPLY lineApply
	left outer join TB_SITE_LINE_SITE_DATA  lineSiteData
	on lineApply.APP_ID = lineSiteData.APP_ID
	left outer join TB_SITE_LOCATION siteLoc
	on lineSiteData.LOC_ID = siteLoc.LOCATION_ID
	left outer join TB_SITE_LOCATION siteLocA
	on lineApply.A_LOC = siteLocA.LOCATION_ID
	left outer join TB_SITE_LOCATION siteLocB
	on lineApply.B_LOC = siteLocB.LOCATION_ID
	where lineApply.APP_ID=#{appId}
  </select>
  
  <select id="selectLine"  resultMap="BaseResultMap">
  	select  
  		lineApply.APP_ID,
  		lineApply.O_LINE_ID,
		lineApply.LINE_ID, 
		aSiteMain.BTS_SITE_ID A_BTS_SITE_ID,
		aSiteMain.SITE_NAME A_SITE_NAME,
		bSiteMain.BTS_SITE_ID B_BTS_SITE_ID,
		bSiteMain.SITE_NAME B_SITE_NAME,
		lineApply.A_LOC,
		lineApply.VENDOR,
		lineApply.LINE_PURPOSE,
		lineApply.LINE_TYPE,
		lineApply.LINE_SPEED,
		lineApply.USE_TYPE,
		lineApply.NET_CFG_DATE,
		lineApply.LINE_STATUS
	from TB_SITE_LINE_APPLY lineApply
	left outer join TB_SITE_MAIN aSiteMain on aSiteMain.LOCATION_ID = lineApply.A_LOC
	left outer join TB_SITE_MAIN bSiteMain on bSiteMain.LOCATION_ID = lineApply.B_LOC 
   	<where>
		<if test="lineId !=null and lineId !=''">
			and lineApply.LINE_ID = #{lineId}
		</if>		
		<if test="lineStatus != null and lineStatus !=''">
			and lineApply.LINE_STATUS = #{lineStatus}
		</if>
		<if test="appDept !=null and appDept !=''">
			and lineApply.APP_DEPT = #{appDept}
		</if>		
		<if test="aBtsSiteId != null and aBtsSiteId !=''">
			and aSiteMain.BTS_SITE_ID = #{aBtsSiteId}
		</if>
		<if test="bBtsSiteId != null and bBtsSiteId !=''">
		    and bSiteMain.BTS_SITE_ID = #{bBtsSiteId}
		</if>
		and lineApply.LINE_STATUS = 'L02'
	</where>
  </select>
  
  <select id="selectByExcelExport" resultMap="BaseResultMap" >
  		select	locationA.MAINT_AREA,
				lineApply.A_LOC,
				locationA.LOC_NAME as A_LOC_NAME,
				locationA.ADDR A_ADDR,
				locationA.CNT_PSN as A_CNT_PSN,
				persA.CHN_NM      as A_CNT_NAME,
				locationA.CNT_TEL as A_CNT_TEL,
				lineApply.B_LOC,
				locationB.LOC_NAME as B_LOC_NAME,
			    lineApply.B_ADDR,
			    lineApply.CNT_PSN AS B_CNT_PSN ,
			    persB.CHN_NM AS B_CNT_NAME,
			    lineApply.CNT_TEL AS B_CNT_TEL, 
			    syslookup.NAME as LINE_SPEED_NAME,
			    lineApply.APP_TIME,
			    lineApply.LINE_ID 
		from TB_SITE_LINE_APPLY lineApply
		 		left outer join TB_SYS_LOOKUP sysLookup on 
			 		sysLookup.TYPE = ('CIRCUIT_TYPE_'+lineApply.LINE_TYPE)
					and sysLookup.CODE = lineApply.LINE_SPEED
				left outer join TB_SITE_LOCATION locationA on
					locationA.LOCATION_ID = lineApply.A_LOC
				left outer join TB_SITE_LOCATION locationB on
					locationB.LOCATION_ID = lineApply.B_LOC
				left outer join TB_AUTH_PERSONNEL persA on
					persA.PSN_NO = locationA.MAINT_USER
				left outer join TB_AUTH_PERSONNEL persB on
					persB.PSN_NO = locationB.MAINT_USER
		where lineApply.APP_ID=#{appId}      
  </select>
  
  <select id="selectLineNumber" parameterType="com.foya.dao.mybatis.model.TbSiteLineApply" resultMap="BaseResultMap">
  		select COUNT(APP_ID) LINE_NUMBER from TB_SITE_LINE_APPLY
  		<where>
  			<if test="a_LOC != null and a_LOC != '' ">
  					AND a_LOC = #{a_LOC}
  			</if>
  			<if test="b_LOC != null and b_LOC != '' ">
  					AND b_LOC = #{b_LOC}
  			</if>
  			<if test="LINE_STATUS != null and LINE_STATUS != '' ">
  					AND LINE_STATUS = #{LINE_STATUS}
  			</if>
  		</where>
  </select>
  
  
</mapper>