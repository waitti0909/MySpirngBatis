<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.foya.dao.mybatis.mapper.UTbLsResExchMapper">
  <resultMap id="BaseResultMap" type="com.foya.noms.dto.ls.TbLsResExchDTO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 03 14:05:01 CST 2015.
    -->
    <result column="LS_NO" jdbcType="VARCHAR" property="LS_NO" />
    <result column="LS_VER" jdbcType="VARCHAR" property="LS_VER" />
    <result column="LOCATION_ID" jdbcType="VARCHAR" property="LOCATION_ID" />
    <result column="EXCH_LOC_ID" jdbcType="VARCHAR" property="EXCH_LOC_ID" />
    <result column="EXCH_CARRIERS" jdbcType="VARCHAR" property="EXCH_CARRIERS" />
    <result column="EXCH_ITEM" jdbcType="VARCHAR" property="EXCH_ITEM" />
    <result column="EXCH_DESC" jdbcType="VARCHAR" property="EXCH_DESC" />
    <result column="EQUIP_2G" jdbcType="DECIMAL" property="EQUIP_2G" />
    <result column="EQUIP_3G" jdbcType="DECIMAL" property="EQUIP_3G" />
    <result column="EQUIP_4G" jdbcType="DECIMAL" property="EQUIP_4G" />
    <result column="CR_USER" jdbcType="VARCHAR" property="CR_USER" />
    <result column="CR_TIME" jdbcType="TIMESTAMP" property="CR_TIME" />
    <result column="MD_USER" jdbcType="VARCHAR" property="MD_USER" />
    <result column="MD_TIME" jdbcType="TIMESTAMP" property="MD_TIME" />
  </resultMap>
  
  <select id="loadTbLsResExchList" resultMap="BaseResultMap" parameterType="String">
	SELECT S.LOC_NAME AS LocName,
	       S.ADDR AS Addr,
		   R.*
	  FROM TB_LS_RES_EXCH R ,TB_SITE_LOCATION S
	WHERE R.EXCH_LOC_ID = S.LOCATION_ID
	  AND R.LOCATION_ID = #{locId}
	  AND R.LS_NO = #{lsNo}
	  AND R.LS_VER = #{lsVer}
	</select>
	
	
	<select id="loadTbLsResExchAddedList" resultMap="BaseResultMap" parameterType="String">
	SELECT S.LOC_NAME AS LocName,
	       S.ADDR AS Addr,
		   R.*
	  FROM TB_LS_RES_EXCH_Added R ,TB_SITE_LOCATION S
	WHERE R.EXCH_LOC_ID = S.LOCATION_ID
	  AND R.LOCATION_ID = #{locId}
	  AND R.APP_SEQ= #{appSeq}
	</select>
	
	
	<select id="getLsResExchByLsNoVer" resultMap="BaseResultMap" parameterType="String">
	SELECT R.*
	  FROM TB_LS_RES_EXCH R 
	WHERE R.LS_NO = #{lsNo}
	  <if test="locId!=null and locId!=''">
	  	AND R.LOCATION_ID = #{locId}
	 </if>
	  <choose>
		    <when test="lsVer != null and lsVer != ''">
		      and r.ls_ver =#{lsVer} 
		    </when>
		    <otherwise>
		   	 and r.ls_ver = (Select max(CONVERT(INT, LS_VER)) from TB_LS_RES_EXCH where ls_no = #{lsNo}  <if test="locId!=null and locId!=''">and LOCATION_ID = #{locId} </if>)
		    </otherwise>
		</choose>
	 
	</select>
	
	<select id="getMaxLsVer" resultMap="BaseResultMap" parameterType="String">
		SELECT
		MAX (CONVERT(INT, LS_VER)) AS LS_VER
	FROM
		TB_LS_RES_EXCH
	WHERE
		LS_NO = #{lsNo}
	</select>
</mapper>