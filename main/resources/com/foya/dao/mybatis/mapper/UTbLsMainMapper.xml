<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.foya.dao.mybatis.mapper.UTbLsMainMapper">
  <resultMap id="BaseResultMap" type="com.foya.noms.dto.ls.LeaseMainDTO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Feb 16 15:25:35 CST 2015.
    -->
    <id column="LS_NO" jdbcType="VARCHAR" property="LS_NO" />
    <id column="LS_VER" jdbcType="VARCHAR" property="LS_VER" />
    <result column="LS_STATUS" jdbcType="VARCHAR" property="LS_STATUS" />
    <result column="ORI_LS_NO" jdbcType="VARCHAR" property="ORI_LS_NO" />
    <result column="LS_KIND" jdbcType="VARCHAR" property="LS_KIND" />
    <result column="LS_NAME" jdbcType="VARCHAR" property="LS_NAME" />
    <result column="SIGN_DATE" jdbcType="TIMESTAMP" property="SIGN_DATE" />
    <result column="DEAL_DEPT_ID" jdbcType="VARCHAR" property="DEAL_DEPT_ID" />
    <result column="DEAL_USER" jdbcType="VARCHAR" property="DEAL_USER" />
    <result column="APP_USER_DEPT" jdbcType="VARCHAR" property="APP_USER_DEPT" />
    <result column="APP_USER" jdbcType="VARCHAR" property="APP_USER" />
    <result column="LS_DOMAIN" jdbcType="VARCHAR" property="LS_DOMAIN" />
    <result column="KEEP_DEPT" jdbcType="VARCHAR" property="KEEP_DEPT" />
    <result column="KEEP_PLACE" jdbcType="VARCHAR" property="KEEP_PLACE" />
    <result column="FORM_ID" jdbcType="VARCHAR" property="FORM_ID" />
    <result column="UNFRMT" jdbcType="VARCHAR" property="UNFRMT" />
    <result column="OP_DOMAIN" jdbcType="VARCHAR" property="OP_DOMAIN" />
    <result column="LS_ADD" jdbcType="VARCHAR" property="LS_ADD" />
    <result column="LS_ZIP" jdbcType="VARCHAR" property="LS_ZIP" />
    <result column="LS_ADD_STD" jdbcType="VARCHAR" property="LS_ADD_STD" />
    <result column="PLC_TYPE" jdbcType="VARCHAR" property="PLC_TYPE" />
    <result column="PLC_S_DATE" jdbcType="TIMESTAMP" property="PLC_S_DATE" />
    <result column="PLC_E_DATE" jdbcType="TIMESTAMP" property="PLC_E_DATE" />
    <result column="LS_S_DATE" jdbcType="TIMESTAMP" property="LS_S_DATE" />
    <result column="LS_E_DATE" jdbcType="TIMESTAMP" property="LS_E_DATE" />
    <result column="PAY_MONTH" jdbcType="DECIMAL" property="PAY_MONTH" />
    <result column="PAY_DAY" jdbcType="DECIMAL" property="PAY_DAY" />
    <result column="EXT_TYPE" jdbcType="VARCHAR" property="EXT_TYPE" />
    <result column="EXT_RMIND" jdbcType="DECIMAL" property="EXT_RMIND" />
    <result column="RENT_TYPE" jdbcType="VARCHAR" property="RENT_TYPE" />
    <result column="PENALTY_DAY" jdbcType="DECIMAL" property="PENALTY_DAY" />
    <result column="PENALTY_DESC" jdbcType="VARCHAR" property="PENALTY_DESC" />
    <result column="SEAL_PURP" jdbcType="VARCHAR" property="SEAL_PURP" />
    <result column="SEAL_RESN" jdbcType="VARCHAR" property="SEAL_RESN" />
    <result column="SEALS" jdbcType="VARCHAR" property="SEALS" />
    <result column="SEAL_OTHERS" jdbcType="VARCHAR" property="SEAL_OTHERS" />
    <result column="SEAL_DESC" jdbcType="VARCHAR" property="SEAL_DESC" />
    <result column="STAMPER" jdbcType="VARCHAR" property="STAMPER" />
    <result column="CLA_ID" jdbcType="VARCHAR" property="CLA_ID" />
    <result column="LS_DESC" jdbcType="VARCHAR" property="LS_DESC" />
    <result column="CR_USER" jdbcType="VARCHAR" property="CR_USER" />
    <result column="CR_TIME" jdbcType="TIMESTAMP" property="CR_TIME" />
    <result column="MD_USER" jdbcType="VARCHAR" property="MD_USER" />
    <result column="MD_TIME" jdbcType="TIMESTAMP" property="MD_TIME" />
    <result column="STOP_RESN" jdbcType="VARCHAR" property="STOP_RESN" />
    <result column="STOP_B_DATE" jdbcType="TIMESTAMP" property="STOP_B_DATE" />
    <result column="STOP_E_DATE" jdbcType="TIMESTAMP" property="STOP_E_DATE" />
    <result column="STOP_MONTH" jdbcType="DECIMAL" property="STOP_MONTH" />
    <result column="RENT_TYPE_CHG" jdbcType="VARCHAR" property="RENT_TYPE_CHG" />
    <result column="RENT_CHG_DATE" jdbcType="TIMESTAMP" property="RENT_CHG_DATE" />
    <result column="EXPENSE_CAT" jdbcType="VARCHAR" property="EXPENSE_CAT" />
    <result column="PLDG_CL" jdbcType="VARCHAR" property="PLDG_CL" />
    <result column="EXCH_CARRIERS" jdbcType="VARCHAR" property="EXCH_CARRIERS" />
    <result column="EXCH_ITEM" jdbcType="VARCHAR" property="EXCH_ITEM" />
  </resultMap>
  
   <resultMap id="LeaseDomainMoneyDTO" type="com.foya.noms.dto.ls.LeaseDomainMoneyDTO">
    <result column="domainName" jdbcType="VARCHAR" property="domainName" />
    <result column="domain" jdbcType="VARCHAR" property="domain" />
    <result column="kind" jdbcType="VARCHAR" property="kind" />
    <result column="rent" jdbcType="DECIMAL" property="rent" />
    <result column="pledge" jdbcType="DECIMAL" property="pledge" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Feb 16 15:25:35 CST 2015.
    -->
    LS_NO, LS_VER, LS_STATUS, ORI_LS_NO, LS_KIND, LS_NAME, SIGN_DATE, DEAL_DEPT_ID, DEAL_USER, 
    APP_USER_DEPT, APP_USER, LS_DOMAIN, KEEP_DEPT, KEEP_PLACE, FORM_ID, UNFRMT, OP_DOMAIN, 
    LS_ADD, LS_ZIP, LS_ADD_STD, PLC_TYPE, PLC_S_DATE, PLC_E_DATE, LS_S_DATE, LS_E_DATE, 
    PAY_MONTH, PAY_DAY, EXT_TYPE, EXT_RMIND, RENT_TYPE, PENALTY_DAY, PENALTY_DESC, SEAL_PURP, 
    SEAL_RESN, SEALS, SEAL_OTHERS, SEAL_DESC, STAMPER, CLA_ID, LS_DESC, CR_USER, CR_TIME, 
    MD_USER, MD_TIME, STOP_RESN, STOP_B_DATE, STOP_E_DATE, STOP_MONTH, RENT_TYPE_CHG, 
    RENT_CHG_DATE, EXPENSE_CAT, PLDG_CL, EXCH_CARRIERS, EXCH_ITEM
  </sql>
  
  <select id="getLsMainByNo" resultMap="BaseResultMap">
  	SELECT main.* ,
           dept.DEPT_NAME AS APP_USER_DEPT_NAME, 
           person.CHN_NM AS APP_USER_NAME
    FROM TB_LS_MAIN main,TB_ORG_DEPT dept, TB_AUTH_PERSONNEL person
    WHERE LS_NO = #{lsNo}
      <choose>
		    <when test="lsVer != null and lsVer != ''">
		      and ls_ver =#{lsVer} 
		    </when>
		    <otherwise>
		   	 and ls_ver = (Select max(CONVERT(INT, LS_VER)) from tb_ls_location where ls_no = #{lsNo} )
		    </otherwise>
		</choose>
      AND main.APP_USER_DEPT  = dept.DEPT_ID
  	  AND main.APP_USER = person.PSN_NO
  </select>
  
  <select id="getLsMainAddedByAppSeq" resultMap="BaseResultMap">
  	SELECT main.* ,
           dept.DEPT_NAME AS APP_USER_DEPT_NAME, 
           person.CHN_NM AS APP_USER_NAME
    FROM TB_LS_MAIN_ADDED main,TB_ORG_DEPT dept, TB_AUTH_PERSONNEL person
    WHERE APP_SEQ = #{appSeq}
      AND main.APP_USER_DEPT  = dept.DEPT_ID
  	  AND main.APP_USER = person.PSN_NO
  </select>
  
  <select id="selectLsMainBylsNoVerMax" resultMap="BaseResultMap">
  	Select * from TB_LS_MAIN 
	where 
	LS_VER=(Select max(CONVERT(INT, LS_VER)) from TB_LS_MAIN where ls_no = #{lsNo})
	 and ls_no = #{lsNo}
  </select>
  
  
  
  <select id="selectEffectivesMainBylsNoVerMax" resultMap="BaseResultMap">
  	Select * from TB_LS_MAIN 
	where 
	LS_VER=(Select max(CONVERT(INT, LS_VER)) from TB_LS_MAIN where ls_no = #{lsNo})
	and LS_STATUS=1 
	 and ls_no = #{lsNo}
  </select>
   <select id="getMaxEndDate" resultMap="BaseResultMap">
  	select MAX(ls_e_date) ls_e_date,ls_no from TB_LS_MAIN where ls_no=#{lsNo} and ls_status='1' group by ls_no
  </select>
  
  <select id="getContractValue" resultType="com.foya.dao.mybatis.model.TbLsMain" resultMap="BaseResultMap">
  	SELECT LS_NAME, LS_S_DATE
	FROM TB_LS_MAIN 
	WHERE LS_NO=#{contractNo}
	AND LS_STATUS=1
  </select>
  
  
  
  <select id="getLeaseAllRentPledgeByDomain"  resultMap="LeaseDomainMoneyDTO">
 select  d.NAME domainName, temp.* from (
select a.domain,ISNULL(sum(a.rent_amt),0)  rent,ISNULL(sum(a.pldg_amt),0) pledge ,'Rent'  kind from tb_ls_location a where
 LS_NO=#{lsNo} and ls_ver=#{lsVer}
group by DOMAIN,ls_no,ls_ver  
union 
select a.domain, '0',sum(b.ELEC_PLEDGE),'Elec'kind   from tb_ls_location a , tb_ls_loc_elec b 
where a.LS_NO=b.LS_NO and a.LS_VER=b.ls_ver and a.LOCATION_ID=b.location_id 
 and  a.LS_NO=#{lsNo} and a.ls_ver=#{lsVer}
group by a.domain
) temp, tb_org_domain d where temp.domain=d.ID
order by kind desc,domain
  </select>
</mapper>