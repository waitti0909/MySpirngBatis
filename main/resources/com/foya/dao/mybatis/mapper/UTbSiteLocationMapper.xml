<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.foya.dao.mybatis.mapper.UTbSiteLocationMapper">
	<resultMap id="BaseResultMap" type="com.foya.noms.dto.st.SiteLocationDTO">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Oct 29 
			14:17:20 CST 2014. -->
		<id column="LOCATION_ID" jdbcType="VARCHAR" property="LOCATION_ID" />
		<result column="LOC_NAME" jdbcType="VARCHAR" property="LOC_NAME" />
		<result column="LOC_TYPE" jdbcType="VARCHAR" property="LOC_TYPE" />
		<result column="LON" jdbcType="DECIMAL" property="LON" />
		<result column="LAT" jdbcType="DECIMAL" property="LAT" />
		<result column="MAINT_AREA" jdbcType="VARCHAR" property="MAINT_AREA" />
		<result column="MAINT_DEPT" jdbcType="VARCHAR" property="MAINT_DEPT" />
		<result column="MAINT_TEAM" jdbcType="VARCHAR" property="MAINT_TEAM" />
		<result column="MAINT_USER" jdbcType="VARCHAR" property="MAINT_USER" />
		<result column="LOC_DESC" jdbcType="VARCHAR" property="LOC_DESC" />
		<result column="BASE_TYPE" jdbcType="VARCHAR" property="BASE_TYPE" />
		<result column="INDOOR_OPTION" jdbcType="VARCHAR" property="INDOOR_OPTION" />
		<result column="NS_LEVEL" jdbcType="VARCHAR" property="NS_LEVEL" />
		<result column="BUILDING_HEIGHT" jdbcType="NUMERIC" property="BUILDING_HEIGHT" />
		<result column="IS_FREEENTER" jdbcType="CHAR" property="IS_FREEENTER" />
		<result column="IS_KEY" jdbcType="CHAR" property="IS_KEY" />
		<result column="IS_INDOOR" jdbcType="CHAR" property="IS_INDOOR" />
		<result column="NEED_MISC_LIC" jdbcType="CHAR" property="NEED_MISC_LIC" />
		<result column="HAS_MISC_LIC" jdbcType="CHAR" property="HAS_MISC_LIC" />
		<result column="ADDR" jdbcType="VARCHAR" property="ADDR" />
		<result column="ZIP" jdbcType="VARCHAR" property="ZIP" />
		<result column="CITY" jdbcType="VARCHAR" property="CITY" />
		<result column="AREA" jdbcType="VARCHAR" property="AREA" />
		<result column="VILLAGE" jdbcType="VARCHAR" property="VILLAGE" />
		<result column="ADJACENT" jdbcType="VARCHAR" property="ADJACENT" />
		<result column="ROAD" jdbcType="VARCHAR" property="ROAD" />
		<result column="LANE" jdbcType="VARCHAR" property="LANE" />
		<result column="ALLEY" jdbcType="VARCHAR" property="ALLEY" />
		<result column="SUB_ALLEY" jdbcType="VARCHAR" property="SUB_ALLEY" />
		<result column="DOOR_NO" jdbcType="VARCHAR" property="DOOR_NO" />
		<result column="DOOR_NO_EX" jdbcType="VARCHAR" property="DOOR_NO_EX" />
		<result column="FLOOR" jdbcType="VARCHAR" property="FLOOR" />
		<result column="FLOOR_EX" jdbcType="VARCHAR" property="FLOOR_EX" />
		<result column="ROOM" jdbcType="VARCHAR" property="ROOM" />
		<result column="ADD_OTHER" jdbcType="VARCHAR" property="ADD_OTHER" />
		<result column="CR_USER" jdbcType="VARCHAR" property="CR_USER" />
		<result column="CR_TIME" jdbcType="TIMESTAMP" property="CR_TIME" />
		<result column="MD_USER" jdbcType="VARCHAR" property="MD_USER" />
		<result column="MD_TIME" jdbcType="TIMESTAMP" property="MD_TIME" />
		<!-- follows extends -->
		<result column="TOWN_NAME" jdbcType="VARCHAR" property="townName" />
		<result column="CITY_AREA_NAME" jdbcType="VARCHAR" property="cityAreaName" />
		<result column="BTS_SITE_ID" jdbcType="VARCHAR" property="btsSiteId" />
		<result column="SITE_ID" jdbcType="VARCHAR" property="siteId" />
		<result column="SITE_TYPE" jdbcType="VARCHAR" property="siteType" />
		<result column="SITE_STATUS" jdbcType="VARCHAR" property="siteStatus" />
		<result column="FEQ_ID" jdbcType="VARCHAR" property="feqId" />
		<result column="MAINT_AREA_NAME" jdbcType="VARCHAR" property="maintAreaName" />
		<result column="MAINT_DEPT_NAME" jdbcType="VARCHAR" property="maintDeptName" />
		<result column="MAINT_TEAM_NAME" jdbcType="VARCHAR" property="maintTeamName" />
		<result column="MAINT_CHN_NM" jdbcType="VARCHAR" property="maintChnNm" />
        <result column="MAINT_CELLULAR" jdbcType="VARCHAR" property="maintCellular" />
	</resultMap>
	<sql id="Base_Column_List">
		LOCATION_ID, LOC_NAME, LOC_TYPE, LON, LAT, MAINT_AREA, MAINT_DEPT, MAINT_TEAM,
		MAINT_USER,
		LOC_DESC, BASE_TYPE, INDOOR_OPTION, NS_LEVEL, BUILDING_HEIGHT, 
		IS_FREEENTER,
		IS_KEY, IS_INDOOR, NEED_MISC_LIC, HAS_MISC_LIC, ADDR, ZIP, CITY, AREA,
		VILLAGE, ADJACENT,
		ROAD, LANE, ALLEY, SUB_ALLEY, DOOR_NO, DOOR_NO_EX, FLOOR, FLOOR_EX, ROOM,
		ADD_OTHER,
		CR_USER, CR_TIME, MD_USER, MD_TIME
	</sql>
	<select id="selectByPrimaryKey" parameterType="java.lang.String"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Jan 08 
			18:48:27 CST 2015. -->
		select
			LOCATION_ID, LOC_NAME, LOC_TYPE, LON, LAT,  
			LOC_DESC, BASE_TYPE, INDOOR_OPTION, NS_LEVEL, BUILDING_HEIGHT, SHARE_TYPE,
			IS_FREEENTER, IS_KEY, IS_INDOOR, NEED_MISC_LIC, HAS_MISC_LIC, SR_ID, IS_EXCHANGE,
			ADDR, ZIP, CITY, AREA, VILLAGE, ADJACENT, ROAD, LANE, ALLEY,
			SUB_ALLEY, DOOR_NO,
			DOOR_NO_EX, FLOOR, FLOOR_EX, ROOM, ADD_OTHER, SPACE_ROOM, SPACE_ROOF, SPACE_TOP,
			SPACE_PLATFORM, SPACE_LAND, SPACE_INDOOR, SPACE_OUTDOOR, FOOTAGE,
			EMP_RELATION, OWNER,
			city.CITY_NAME CITY_NAME,
			town.TOWN_NAME TOWN_NAME,
			MAINT_AREA, orgDomain.NAME MAINT_AREA_NAME,
			MAINT_DEPT, orgDept.DEPT_NAME MAINT_DEPT_NAME,
			MAINT_TEAM, orgDept2.DEPT_NAME MAINT_TEAM_NAME,
			MAINT_USER, personnel.CHN_NM MAINT_CHN_NM,
	        personnel.CELLULAR MAINT_CELLULAR,
			CNT_PSN, CNT_TEL
		from TB_SITE_LOCATION
			left outer join TB_COM_CITY city on
			CITY = city.CITY_ID
			left outer join TB_COM_TOWN town on
			AREA = town.TOWN_ID and town.CITY_ID = city.CITY_ID
			left outer join TB_ORG_DOMAIN orgDomain on
			MAINT_AREA = orgDomain.ID
			left outer join TB_ORG_DEPT orgDept on
			MAINT_DEPT = orgDept.DEPT_ID
			left outer join TB_ORG_DEPT orgDept2 on
			MAINT_TEAM = orgDept2.DEPT_ID
			left outer join TB_AUTH_PERSONNEL personnel ON
			personnel.PSN_NO = MAINT_USER and personnel.DEPT_ID = orgDept2.DEPT_ID
		where LOCATION_ID = #{LOCATION_ID,jdbcType=VARCHAR}
	</select>

	<select id="selectCondition" resultMap="BaseResultMap">
		select LOCATION_ID,LOC_NAME,TOWN_NAME ,ADDR,LOC_TYPE,MAINT_CHN_NM ,CITY,AREA,BTS_SITE_ID from(
        select 
		loc.LOCATION_ID,LOC_NAME,town.TOWN_NAME TOWN_NAME,ADDR,LOC_TYPE,psn.CHN_NM MAINT_CHN_NM
		,loc.CITY,loc.AREA,		
		STUFF( (
		SELECT ','+BTS_SITE_ID  FROM TB_SITE_MAIN a
		WHERE loc.LOCATION_ID = a.LOCATION_ID and a.SITE_STATUS != 'S11'
		FOR XML PATH('') ) , 1, 1, '' )as BTS_SITE_ID
		from TB_SITE_LOCATION loc
		left outer join TB_SITE_MAIN main
		on loc.LOCATION_ID = main.LOCATION_ID
		left outer join TB_COM_TOWN town
		on loc.AREA = town.TOWN_ID
		left outer join TB_AUTH_PERSONNEL psn
		on loc.MAINT_USER = psn.PSN_NO
		<where>
			<if test="locationId !=null and locationId !=''">
				and loc.LOCATION_ID = #{locationId}
			</if>
			<if test="locName !=null and locName !=''">
				and LOC_NAME like '%'+#{locName}+'%'
			</if>
			<if test="locCity !=null and locCity !=''">
				and CITY = #{locCity}
			</if>
			<if test="locTown !=null and locTown !=''">
				and AREA = #{locTown}
			</if>
			<if test="locType !=null and locType !=''">
				and LOC_TYPE = #{locType}
			</if>
			<if test="btsSiteId !=null and btsSiteId !=''">
				and BTS_SITE_ID = #{btsSiteId}
			</if>
			<if test="siteStatus !=null and siteStatus !=''">
				and main.SITE_STATUS = #{siteStatus}
			</if>
			<if test="siteFeq !=null and siteFeq !=''">
				and main.FEQ_ID = #{siteFeq}
			</if>
		</where>
		) A
		GROUP BY LOCATION_ID,LOC_NAME,TOWN_NAME ,ADDR,LOC_TYPE,MAINT_CHN_NM ,CITY,AREA,BTS_SITE_ID
		
	</select>
	<select id="selectByCondition" resultMap="BaseResultMap">
		select main.BTS_SITE_ID,loc.LOC_NAME,city.CITY_NAME+' '+town.TOWN_NAME as CITY_AREA_NAME,
		loc.CITY,loc.AREA,loc.ADDR,loc.LOC_TYPE,psn.CHN_NM MAINT_CHN_NM
		,loc.LOCATION_ID,main.SITE_ID,main.SITE_STATUS
		from TB_SITE_LOCATION loc
		left outer join TB_SITE_MAIN main
		on loc.LOCATION_ID = main.LOCATION_ID
		left outer join TB_AUTH_PERSONNEL psn
		on loc.MAINT_USER = psn.PSN_NO
		left outer join TB_COM_CITY city
		on loc.CITY = city.CITY_ID
		left outer join TB_COM_TOWN town
		on loc.area = town.TOWN_ID
		<where>
			and loc.LOC_TYPE in('M','H','C')
			<if test="btsSiteId !=null and btsSiteId !=''">
				and main.BTS_SITE_ID = #{btsSiteId}
			</if>
			<if test="engineRoomStatus !=null and engineRoomStatus !=''">
				and main.SITE_STATUS = #{engineRoomStatus}
			</if>
			<if test="engineRoomName !=null and engineRoomName !=''">
				and loc.LOC_NAME like '%'+#{engineRoomName}+'%'
			</if>
			<if test="engineRoomType !=null and engineRoomType !=''">
				and loc.LOC_TYPE = #{engineRoomType}
			</if>
			<if test="engineRoomCity !=null and engineRoomCity !=''">
				and loc.CITY = #{engineRoomCity}
			</if>
			<if test="engineRoomArea !=null and engineRoomArea !=''">
				and loc.AREA = #{engineRoomArea}
			</if>
		</where>
	</select>
	
</mapper>